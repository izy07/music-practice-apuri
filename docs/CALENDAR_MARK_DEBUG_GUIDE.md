# カレンダーマーク表示デバッグガイド

## 問題
カレンダーに記録してもマークが表示されない

## 修正内容

### 1. 日付パラメータの追加
- `savePracticeSessionWithIntegration`関数に`practiceDate`パラメータを追加
- 選択された日付で保存するように修正

### 2. データ更新タイミングの改善
- 保存後に300msの遅延を追加してからデータを更新
- データベースへの反映を確実にするため

### 3. デバッグログの追加
- 保存処理、データ更新、データ取得の各段階でログを出力
- 問題の特定を容易にするため

## デバッグ方法

### ブラウザのコンソールを確認
1. 開発者ツールを開く（F12）
2. コンソールタブを選択
3. 練習記録を保存する
4. 以下のログを確認：

#### 期待されるログ出力
```
🔄 カレンダーデータを更新中...
✅ 手動記録のカレンダーデータを更新しました
📊 練習データを処理中: { sessionsCount: X, ... }
✅ 練習データを更新: { practiceData: [...], total: X }
```

### 確認ポイント

1. **保存日付が正しいか**
   - ログに表示される`practice_date`が選択した日付と一致しているか
   - `date`フィールドも確認

2. **データ取得が成功しているか**
   - `📊 練習データを処理中`のログが表示されているか
   - `sessionsCount`が0より大きいか

3. **データ更新が反映されているか**
   - `✅ 練習データを更新`のログが表示されているか
   - `practiceData`に保存した日付のデータが含まれているか

4. **現在表示している月と一致しているか**
   - 保存した日付が現在表示している月の範囲内か
   - 範囲外の場合は、該当月を表示する必要がある

## トラブルシューティング

### マークが表示されない場合

1. **現在表示している月を確認**
   - 保存した日付が現在表示している月の範囲内か確認
   - 範囲外の場合は、該当月に移動して確認

2. **楽器IDが一致しているか**
   - 保存時に使用した楽器IDと、表示時にフィルタリングしている楽器IDが一致しているか確認
   - 楽器を変更した場合は、正しい楽器が選択されているか確認

3. **データベースに保存されているか**
   - Supabaseのダッシュボードで`practice_sessions`テーブルを確認
   - 保存したレコードが存在するか確認
   - `practice_date`、`instrument_id`、`duration_minutes`の値が正しいか確認

4. **キャッシュの問題**
   - ブラウザのキャッシュをクリア
   - ページをリロード

## 関連ファイル

- `app/(tabs)/index.tsx` - カレンダー画面
- `hooks/tabs/useCalendarData.ts` - カレンダーデータ管理
- `repositories/practiceSessionRepository.ts` - 練習記録の保存
- `components/PracticeRecordModal.tsx` - 練習記録入力モーダル



