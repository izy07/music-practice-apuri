# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šã¨ä¾å­˜é–¢ä¿‚æ”¹å–„ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“‹ å®Ÿè¡Œæ¦‚è¦

- **å®Ÿè¡Œæ—¥**: 2025å¹´1æœˆ
- **ç›®çš„**: 
  1. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®å‘ä¸Šï¼ˆPriority 1ï¼‰
  2. Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å‰Šæ¸›ï¼ˆPriority 2ï¼‰
- **å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€timer.tsxã€profile-settings.tsx

---

## âœ… å®Ÿæ–½å†…å®¹

### 1. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®å‘ä¸Š

#### æ–°è¦ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**:
- `__tests__/components/timer/Stopwatch.test.tsx` (æ–°è¦)
- `__tests__/components/metronome/Metronome.test.tsx` (æ–°è¦)

**ãƒ†ã‚¹ãƒˆå†…å®¹**:

**Stopwatch.test.tsx**:
- åˆæœŸçŠ¶æ…‹ã®è¡¨ç¤ºç¢ºèª
- æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆåˆ†:ç§’ã€æ™‚:åˆ†:ç§’ï¼‰
- é–‹å§‹/åœæ­¢/ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
- ãƒ©ãƒƒãƒ—æ©Ÿèƒ½
- ãƒ©ãƒƒãƒ—ã‚¿ã‚¤ãƒ ã®è¨˜éŒ²ã¨ã‚¯ãƒªã‚¢

**Metronome.test.tsx**:
- åˆæœŸçŠ¶æ…‹ã®è¡¨ç¤ºç¢ºèª
- BPMè¡¨ç¤ºã¨èª¿æ•´
- æ‹å­é¸æŠ
- éŸ³é¸æŠï¼ˆã‚¯ãƒªãƒƒã‚¯ã€ãƒ“ãƒ¼ãƒ—ã€ãƒ™ãƒ«ã€ãƒãƒ ï¼‰
- ãƒ¡ãƒˆãƒ­ãƒãƒ¼ãƒ é–‹å§‹/åœæ­¢
- ãƒ“ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼

**åŠ¹æœ**:
- æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒå‘ä¸Š
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹•ä½œä¿è¨¼ãŒå¼·åŒ–
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚ã®å®‰å…¨æ€§å‘ä¸Š

---

### 2. Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å‰Šæ¸›

#### æ”¹å–„å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

**timer.tsx**:
- **å¤‰æ›´å‰**: `import { supabase } from '@/lib/supabase'` ã‚’ä½¿ç”¨
- **å¤‰æ›´å¾Œ**: 
  - `savePracticeSessionWithIntegration` ã‚’ `practiceSessionRepository` ã‹ã‚‰ä½¿ç”¨
  - `useAuthAdvanced` ã‹ã‚‰ `user` ã‚’å–å¾—
  - Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å‰Šé™¤

**profile-settings.tsx**:
- **å¤‰æ›´å‰**: `import { supabase } from '@/lib/supabase'` ã‚’ä½¿ç”¨
- **å¤‰æ›´å¾Œ**:
  - `getCurrentUser`, `deleteBreakPeriod`, `deletePastOrganization`, `deleteAward`, `deletePerformance` ã‚’ `userRepository` ã‹ã‚‰ä½¿ç”¨
  - Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å‰Šé™¤

#### ãƒªãƒã‚¸ãƒˆãƒªé–¢æ•°ã®è¿½åŠ 

**userRepository.ts ã«è¿½åŠ ã—ãŸé–¢æ•°**:
- `deleteBreakPeriod(breakPeriodId: string)`: ä¼‘æ­¢æœŸé–“ã®å‰Šé™¤
- `deletePastOrganization(organizationId: string)`: éå»ã®æ‰€å±å›£ä½“ã®å‰Šé™¤
- `deleteAward(awardId: string)`: å—è³ã®å‰Šé™¤
- `deletePerformance(performanceId: string)`: æ¼”å¥çµŒé¨“ã®å‰Šé™¤

**åŠ¹æœ**:
- Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒ2ãƒ•ã‚¡ã‚¤ãƒ«ã§å‰Šæ¸›
- ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¾¹åº•
- ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã®å‘ä¸Šï¼ˆãƒ¢ãƒƒã‚¯å¯èƒ½ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€

---

## ğŸ“Š æ”¹å–„ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

| é …ç›® | å¤‰æ›´å‰ | å¤‰æ›´å¾Œ | æ”¹å–„ |
|------|--------|--------|------|
| æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ | 0å€‹ | 2å€‹ | âœ… |
| ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ•° | 17å€‹ | 19å€‹ | +2å€‹ |

### ä¾å­˜é–¢ä¿‚ã®æ”¹å–„

| é …ç›® | å¤‰æ›´å‰ | å¤‰æ›´å¾Œ | æ”¹å–„ |
|------|--------|--------|------|
| Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆapp/(tabs)ï¼‰ | 16ãƒ•ã‚¡ã‚¤ãƒ« | 14ãƒ•ã‚¡ã‚¤ãƒ« | -2ãƒ•ã‚¡ã‚¤ãƒ« âœ… |
| Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆcomponentsï¼‰ | 6ãƒ•ã‚¡ã‚¤ãƒ« | 6ãƒ•ã‚¡ã‚¤ãƒ« | - |
| ãƒªãƒã‚¸ãƒˆãƒªé–¢æ•°æ•° | - | +4å€‹ | âœ… |

---

## ğŸ¯ é”æˆçŠ¶æ³

### Priority 1: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®å‘ä¸Š âœ…

- [x] æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆMetronomeã€Stopwatchï¼‰ã®ãƒ†ã‚¹ãƒˆä½œæˆ
- [x] ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®è¿½åŠ ï¼ˆ2ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèªï¼ˆæ¬¡å›å®Ÿæ–½ï¼‰

### Priority 2: ä¾å­˜é–¢ä¿‚ã®æ”¹å–„ âœ…

- [x] Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®çŠ¶æ³ç¢ºèª
- [x] timer.tsxã®Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤
- [x] profile-settings.tsxã®Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤
- [x] ãƒªãƒã‚¸ãƒˆãƒªé–¢æ•°ã®è¿½åŠ ï¼ˆ4é–¢æ•°ï¼‰

---

## ğŸ“ ä»Šå¾Œã®æ”¹å–„æ¨å¥¨äº‹é …

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

1. **ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆè¿½åŠ **
   - `PastOrgEditorModal.test.tsx`
   - `AwardEditorModal.test.tsx`
   - `PerformanceEditorModal.test.tsx`
   - `AgeSelectorModal.test.tsx`

2. **çµ±åˆãƒ†ã‚¹ãƒˆã®è¿½åŠ **
   - ãƒ¡ãƒˆãƒ­ãƒãƒ¼ãƒ ã¨ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã®çµ±åˆãƒ†ã‚¹ãƒˆ
   - ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ã®çµ±åˆãƒ†ã‚¹ãƒˆ

3. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª**
   - ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã‚’ç¢ºèª
   - ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆ70%ï¼‰ã¸ã®åˆ°é”è¨ˆç”»

### ä¾å­˜é–¢ä¿‚ã®æ”¹å–„

1. **æ®‹å­˜ã™ã‚‹Supabaseç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å‰Šæ¸›**
   - `app/(tabs)/` å†…ã®æ®‹ã‚Š14ãƒ•ã‚¡ã‚¤ãƒ«
   - `components/` å†…ã®6ãƒ•ã‚¡ã‚¤ãƒ«

2. **ãƒªãƒã‚¸ãƒˆãƒªé–¢æ•°ã®è¿½åŠ **
   - ä¸è¶³ã—ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªé–¢æ•°ã®ç‰¹å®š
   - æ–°è¦ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

3. **ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ´»ç”¨**
   - ãƒªãƒã‚¸ãƒˆãƒªã‚’ç›´æ¥ä½¿ç”¨ã›ãšã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼çµŒç”±ã§ä½¿ç”¨
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®é›†ç´„

---

## ğŸ” æŠ€è¡“çš„è©³ç´°

### ãƒ†ã‚¹ãƒˆå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// ãƒ¢ãƒƒã‚¯ã®è¨­å®š
jest.mock('@/hooks/useTimer');
jest.mock('@/components/InstrumentThemeContext');

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä¾‹
it('åˆæœŸçŠ¶æ…‹ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', () => {
  const { getByText } = render(<Stopwatch />);
  expect(getByText('00:00')).toBeTruthy();
});
```

### ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…

```typescript
// Before: Supabaseç›´æ¥ä½¿ç”¨
await supabase.from('practice_sessions').insert({ ... });

// After: ãƒªãƒã‚¸ãƒˆãƒªçµŒç”±
await savePracticeSessionWithIntegration(userId, minutes, options);
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [COMPREHENSIVE_CODE_REVIEW_2025_POST_REFACTORING.md](./COMPREHENSIVE_CODE_REVIEW_2025_POST_REFACTORING.md) - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ARCHITECTURE_SUMMARY.md](./ARCHITECTURE_SUMMARY.md) - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚µãƒãƒªãƒ¼
- [__tests__/README.md](./__tests__/README.md) - ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®èª¬æ˜

---

**å®Ÿæ–½æ—¥**: 2025å¹´1æœˆ  
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¨å¥¨æ—¥**: 2025å¹´4æœˆï¼ˆ3ãƒ¶æœˆå¾Œï¼‰

