# 巨大ファイル分析レポート

## 📊 巨大ファイル一覧（上位5位）

| 順位 | ファイル名 | 行数 | 主な原因 |
|------|-----------|------|----------|
| 1位 | `beginner-guide.tsx` | **2,313行** | 楽器別ガイドデータ（11種類 × 詳細情報） |
| 2位 | `profile-settings.tsx` | **2,057行** | 多数のモーダル・フォーム・スタイル定義 |
| 3位 | `tuner.tsx` | **1,944行** | 楽器別チューニング設定・スタイル定義 |
| 4位 | `timer.tsx` | **1,929行** | タイマー・ストップウォッチ機能の統合 |
| 5位 | `organization-settings.tsx` | **1,783行** | 組織設定の複雑なフォーム |

---

## 🔍 詳細分析

### 1. `beginner-guide.tsx` (2,313行)

#### 原因
- **楽器別ガイドデータ**: 約1,483行（全体の64%）
  - 11種類の楽器（バイオリン、ビオラ、チェロ、コントラバス、ギター、ピアノ、フルート、クラリネット、サックス、トランペット、トロンボーン、フレンチホルン、チューバ、ドラム）
  - 各楽器に10セクション分の詳細データ：
    - `overview`（基本情報）
    - `basicPlaying`（演奏方法）
    - `fingering`（運指表）
    - `tuning`（チューニング）
    - `maintenance`（お手入れ）
    - `tips`（アドバイス）
    - `repertoire`（練習曲）
    - `resources`（参考資料）
    - `faq`（Q&A）
    - `roadmap`（ロードマップ）
- **スタイル定義**: 約300行（13%）
- **UIレンダリングロジック**: 約530行（23%）

#### 改善提案
- 楽器別ガイドデータを外部JSONファイルまたはデータベースに分離
- 楽器ごとに個別のコンポーネントに分割
- スタイル定義を別ファイル（`styles.ts`）に分離

---

### 2. `profile-settings.tsx` (2,057行)

#### 原因
- **多数のモーダル**: 26箇所のModal関連コード
  - 所属履歴編集モーダル
  - 受賞歴編集モーダル
  - 演奏歴編集モーダル
  - 年齢選択モーダル
  - 誕生日選択モーダル
  - アバター選択モーダル
- **大量のuseState**: 42箇所の状態管理
  - 基本情報（ニックネーム、年齢、誕生日など）
  - 経歴・実績（所属履歴、受賞歴、演奏歴）
  - モーダル表示状態
  - フォーム編集状態
- **スタイル定義**: 約672行（33%）
- **複雑なフォームロジック**: 約800行（39%）

#### 改善提案
- モーダルを個別コンポーネントに分割
- フォームセクションを個別コンポーネントに分割
- スタイル定義を別ファイル（`styles.ts`）に分離
- カスタムフックで状態管理を集約

---

### 3. `tuner.tsx` (1,944行)

#### 原因
- **楽器別チューニング設定**: `INSTRUMENT_TUNINGS`オブジェクト
  - 11種類以上の楽器のチューニング情報
  - 各楽器の開放弦の周波数設定
- **スタイル定義**: 約75箇所のスタイル定義
- **メトロノーム機能**: 完全に統合されたメトロノーム
- **開放弦の音再生機能**: Web Audio APIを使用した音声再生
- **UIコンポーネント**: 複雑なチューナー表示UI

#### 改善提案
- チューニング設定を外部JSONファイルに分離
- メトロノーム機能を別コンポーネントに分離
- スタイル定義を別ファイル（`styles.ts`）に分離
- 楽器別のチューナーコンポーネントに分割

---

### 4. `timer.tsx` (1,929行)

#### 原因
- **タイマー機能**: カスタム時間設定、カウントダウン
- **ストップウォッチ機能**: カウントアップ、ラップタイム
- **アニメーション**: 円形プログレスバーのアニメーション
- **WheelPickerコンポーネント**: ドラムロール風の時間選択UI
- **設定機能**: 音声通知、バイブレーション、自動保存
- **練習時間の記録**: Supabaseへの保存ロジック

#### 改善提案
- タイマーとストップウォッチを別コンポーネントに分割
- WheelPickerを共通コンポーネントに分離
- アニメーションコンポーネントを別ファイルに分離
- 設定機能をカスタムフックに分離

---

### 5. `organization-settings.tsx` (1,783行)

#### 原因
- **組織管理機能**: 組織の作成・編集・削除
- **メンバー管理**: メンバーの追加・削除・権限管理
- **複雑なフォーム**: 組織情報、メンバー情報の入力フォーム
- **権限管理ロジック**: 管理者・メンバーの権限チェック

#### 改善提案
- 組織管理とメンバー管理を別コンポーネントに分割
- フォームを個別コンポーネントに分割
- 権限管理ロジックをカスタムフックに分離

---

## 📈 ファイルサイズの内訳（概算）

### `beginner-guide.tsx` (2,313行)
```
楽器データ:     1,483行 (64%)
スタイル定義:     300行 (13%)
UIロジック:       530行 (23%)
```

### `profile-settings.tsx` (2,057行)
```
スタイル定義:     672行 (33%)
フォームロジック: 800行 (39%)
モーダル:         400行 (19%)
その他:           185行 (9%)
```

### `tuner.tsx` (1,944行)
```
チューニング設定:  400行 (21%)
メトロノーム:     500行 (26%)
UIコンポーネント:  600行 (31%)
スタイル定義:      444行 (22%)
```

### `timer.tsx` (1,929行)
```
タイマー機能:     600行 (31%)
ストップウォッチ: 400行 (21%)
UIコンポーネント: 500行 (26%)
スタイル定義:     429行 (22%)
```

---

## 🎯 改善優先度

### 優先度1（緊急）
1. **`beginner-guide.tsx`**: 楽器データを外部ファイルに分離（約1,483行削減可能）
2. **`profile-settings.tsx`**: モーダルを個別コンポーネントに分割（約400行削減可能）

### 優先度2（重要）
3. **`tuner.tsx`**: メトロノーム機能を分離（約500行削減可能）
4. **`timer.tsx`**: タイマーとストップウォッチを分割（約400行削減可能）

### 優先度3（中程度）
5. **全ファイル**: スタイル定義を別ファイルに分離（各ファイルで200-400行削減可能）

---

## 💡 推奨リファクタリング戦略

### フェーズ1: データの分離
- 楽器別ガイドデータ → `data/instrumentGuides.json`
- チューニング設定 → `data/instrumentTunings.json`

### フェーズ2: コンポーネントの分割
- モーダル → `components/profile-settings/`配下に分割
- フォームセクション → `components/profile-settings/`配下に分割
- メトロノーム → `components/Metronome.tsx`
- タイマー/ストップウォッチ → `components/Timer/`配下に分割

### フェーズ3: スタイルの分離
- 各ファイルのスタイル定義 → `lib/tabs/[screen-name]/styles.ts`

### フェーズ4: カスタムフックの抽出
- 状態管理ロジック → `hooks/use[Feature]State.ts`
- ビジネスロジック → `hooks/use[Feature]Logic.ts`

---

## 📊 期待される改善効果

| ファイル | 現在 | 改善後（予想） | 削減率 |
|---------|------|---------------|--------|
| `beginner-guide.tsx` | 2,313行 | 800行 | **-65%** |
| `profile-settings.tsx` | 2,057行 | 1,000行 | **-51%** |
| `tuner.tsx` | 1,944行 | 1,200行 | **-38%** |
| `timer.tsx` | 1,929行 | 1,200行 | **-38%** |

**合計削減**: 約2,000行以上（全体の約30%削減）

---

## ✅ 次のステップ

1. **データファイルの作成**: `data/instrumentGuides.json`を作成
2. **コンポーネント分割の計画**: 各巨大ファイルの分割計画を立てる
3. **段階的なリファクタリング**: 1ファイルずつ順番に分割
4. **テストの追加**: 分割後のコンポーネントのテストを追加




