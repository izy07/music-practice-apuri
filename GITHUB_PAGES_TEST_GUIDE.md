# GitHub Pages テスト環境整備ガイド

## 概要

このドキュメントは、GitHub PagesでデプロイされたWebアプリケーションのテスト手順を記載しています。

## 環境変数の設定

### GitHub Secrets設定

GitHubリポジトリの Settings → Secrets and variables → Actions で以下のSecretsを設定してください：

- `EXPO_PUBLIC_SUPABASE_URL`: 本番SupabaseプロジェクトのURL（例: `https://your-project.supabase.co`）
- `EXPO_PUBLIC_SUPABASE_ANON_KEY`: 本番Supabaseプロジェクトの匿名キー

**注意**: SupabaseのAnon Keyは公開されても問題ないですが、セキュリティベストプラクティスに従って、Secretsとして管理してください。

### デフォルト値

Secretsが設定されていない場合、以下のデフォルト値が使用されます：

- `EXPO_PUBLIC_SUPABASE_URL`: `https://uteeqkpsezbabdmritkn.supabase.co`
- `EXPO_PUBLIC_SUPABASE_ANON_KEY`: （空文字列）

**推奨**: 本番環境で確実に動作するように、必ずGitHub Secretsを設定してください。

## デプロイ手順

1. `main`ブランチにプッシュすると、自動的にGitHub Pagesにデプロイされます
2. 手動デプロイする場合は、GitHub Actionsの「Deploy to GitHub Pages」ワークフローを実行してください

## テストアカウントの作成

### テスト用アカウント作成方法

1. GitHub PagesのURLにアクセス: `https://izy07.github.io/music-practice-apuri/`
2. 「新規登録」をクリック
3. テスト用のメールアドレスとパスワードを入力
4. メール確認（開発環境の場合はInbucketを確認）

### テストアカウント情報（開発環境用）

開発環境では、Inbucket（`http://127.0.0.1:54324`）でメールを確認できます。

## 主要機能のテストケース

### 1. 認証機能（メール/パスワード認証のみ）

#### 新規登録
- [ ] 新規登録画面にアクセスできる
- [ ] メールアドレス、パスワード、ニックネームを入力できる
- [ ] バリデーションが正しく動作する（8文字以上、小文字と数字を含む）
- [ ] 新規登録が成功する
- [ ] メール確認メールが送信される（開発環境ではInbucketで確認）

#### ログイン
- [ ] ログイン画面にアクセスできる
- [ ] メールアドレスとパスワードを入力できる
- [ ] ログインが成功する
- [ ] ログイン失敗時に適切なエラーメッセージが表示される

#### ログアウト
- [ ] ログアウトボタンが表示される
- [ ] ログアウトが成功する
- [ ] ログアウト後にログイン画面に遷移する

### 2. データベース操作

#### 練習記録
- [ ] 練習記録の作成
- [ ] 練習記録の読み取り
- [ ] 練習記録の更新
- [ ] 練習記録の削除

#### 目標（個人目標のみ）
- [ ] 個人目標の作成（短期目標・長期目標）
- [ ] 個人目標の読み取り
- [ ] 個人目標の更新
- [ ] 個人目標の削除
- [ ] 目標の達成マーク

#### 楽器選択
- [ ] 楽器選択画面にアクセスできる
- [ ] 楽器を選択できる
- [ ] 選択した楽器が保存される
- [ ] 楽器選択後にチュートリアル画面に遷移する

#### プロフィール情報
- [ ] プロフィール情報の表示
- [ ] プロフィール情報の更新
- [ ] ニックネームの変更

### 3. エラーハンドリング

#### 409 Conflictエラー
- [ ] 楽器選択時に409エラーが発生した場合、リトライが動作する
- [ ] エラーメッセージが適切に表示される

#### 外部キー制約エラー
- [ ] 存在しない楽器IDを選択した場合、エラーが適切に処理される
- [ ] エラーメッセージが適切に表示される

### 4. 削除された機能

以下の機能は一時的に削除されています：

- **団体目標**: 削除済み（個人目標のみ利用可能）
- **目標曲**: 削除済み
- **憧れの演奏**: 削除済み
- **Googleログイン**: 一時的に削除（メール/パスワード認証のみ利用可能）

## 既知の問題点と回避方法

### 1. 404エラー（リロード時）

**問題**: GitHub Pagesでリロードすると404エラーが発生する場合がある

**回避方法**: 
- `404.html`が正しく設定されていることを確認
- ベースパス（`/music-practice-apuri`）を含むURLを使用

### 2. データベース接続エラー

**問題**: Supabaseに接続できない

**回避方法**:
- GitHub Secretsに正しい環境変数が設定されていることを確認
- 本番Supabaseデータベースが起動していることを確認

### 3. 楽器データ不足エラー

**問題**: 「Key is not present in table "instruments"」エラー

**回避方法**:
- 本番データベースに必要な楽器データ（特に"Other"楽器）が存在することを確認
- `scripts/fix-all-instruments-production.sql`を実行して楽器データを追加

## テスト用ドキュメントの作成

### テスト手順書

1. **事前準備**
   - GitHub PagesのURLにアクセス
   - テストアカウントを作成

2. **認証テスト**
   - 新規登録 → ログイン → ログアウトの流れをテスト

3. **データベース操作テスト**
   - 各機能（練習記録、目標、楽器選択、プロフィール）のCRUD操作をテスト

4. **エラーハンドリングテスト**
   - 各種エラーケースをテスト

### テスト結果の記録

テスト結果は以下の形式で記録してください：

```
## テスト結果 [YYYY-MM-DD]

### 認証機能
- [x] 新規登録: ✅ 成功
- [x] ログイン: ✅ 成功
- [x] ログアウト: ✅ 成功

### データベース操作
- [x] 練習記録の作成: ✅ 成功
- [x] 目標の作成: ✅ 成功
- [x] 楽器選択: ✅ 成功

### エラーハンドリング
- [x] 409エラーのリトライ: ✅ 成功
```

## 参考リンク

- [GitHub Pages セットアップガイド](./GITHUB_PAGES_SETUP.md)
- [データベースセットアップガイド](./GITHUB_DATABASE_SETUP.md)
- [デプロイ手順](./DEPLOY_INSTRUCTIONS.md)

